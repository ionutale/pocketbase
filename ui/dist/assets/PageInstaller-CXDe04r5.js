import{p as Z,a as ee,r as P,s,m,g as ae,b as v,c as te,t as se,d as e,l as re,e as ie,i as le,F as ne,f as C,h as $,j as o,k as oe,n as T,o as B,q as U,u as x,v as D,w as z,x as W,y as H,z as ue,A as de,B as ce,C as pe,D as fe,E as w,G as E}from"./index-C9Y1y-Co.js";var be=C('<label>Email</label> <input type="email" autocomplete="off" required/>',1),me=C('<label>Password</label> <input type="password" autocomplete="new-password" minlength="10" required/> <div class="help-block">Recommended at least 10 characters.</div>',1),he=C('<label>Password confirm</label> <input type="password" minlength="10" required/>',1),_e=C('<form class="block" autocomplete="off"><div class="content txt-center m-b-base"><h4>Create your first superuser account in order to continue</h4></div> <!> <!> <!> <button type="submit"><span class="txt">Create superuser and login</span> <i class="ri-arrow-right-line"></i></button></form> <hr/>  <label for="backupFileInput"><i class="ri-upload-cloud-line"></i> <span class="txt">Or initialize from backup</span></label> <input id="backupFileInput" type="file" class="hidden" accept=".zip"/>',1);function ke(J,O){Z(O,!1);const u=m();let k=ee(O,"params",8),q=m(""),I=m(""),F=m(""),h=m(!1),g=m(!1),A=m(),y=m();M();async function M(){var a,d,c,l;if(!((a=k())!=null&&a.token))return P("/");s(h,!0);try{const p=ae((d=k())==null?void 0:d.token);await v.collection("_superusers").getOne(p.id,{requestKey:"installer_token_check",headers:{Authorization:(c=k())==null?void 0:c.token}})}catch(p){p!=null&&p.isAbort||(te("The installer token is invalid or has expired."),P("/"))}s(h,!1),await se(),(l=e(A))==null||l.focus()}async function Q(){var a;if(!e(u)){s(h,!0);try{await v.collection("_superusers").create({email:e(q),password:e(I),passwordConfirm:e(F)},{headers:{Authorization:(a=k())==null?void 0:a.token}}),await v.collection("_superusers").authWithPassword(e(q),e(I)),P("/")}catch(d){v.error(d)}s(h,!1)}}function j(){e(y)&&fe(y,e(y).value="")}function V(a){a&&ce(`Note that we don't perform validations for the uploaded backup files. Proceed with caution and only if you trust the file source.

Do you really want to upload and initialize "${a.name}"?`,()=>{X(a)},()=>{j()})}async function X(a){var d,c;if(!(!a||e(u))){s(g,!0);try{await v.backups.upload({file:a},{headers:{Authorization:(d=k())==null?void 0:d.token}}),await v.backups.restore(a.name,{headers:{Authorization:(c=k())==null?void 0:c.token}}),pe("Please wait while extracting the uploaded archive!"),await new Promise(l=>setTimeout(l,2e3)),P("/")}catch(l){v.error(l)}j(),s(g,!1)}}re(()=>(e(h),e(g)),()=>{s(u,e(h)||e(g))}),ie(),le(),ne(J,{children:(a,d)=>{var c=_e(),l=$(c),p=o(oe(l),2);T(p,{class:"form-field required",name:"email",children:B,$$slots:{default:(r,n)=>{const i=E(()=>n.uniqueId);var f=be(),b=$(f),t=o(b,2);U(t,_=>s(A,_),()=>e(A)),x(()=>{w(b,"for",e(i)),w(t,"id",e(i)),t.disabled=e(u)}),D(t,()=>e(q),_=>s(q,_)),z(r,f)}}});var G=o(p,2);T(G,{class:"form-field required",name:"password",children:B,$$slots:{default:(r,n)=>{const i=E(()=>n.uniqueId);var f=me(),b=$(f),t=o(b,2);x(()=>{w(b,"for",e(i)),w(t,"id",e(i)),t.disabled=e(u)}),D(t,()=>e(I),_=>s(I,_)),z(r,f)}}});var K=o(G,2);T(K,{class:"form-field required",name:"passwordConfirm",children:B,$$slots:{default:(r,n)=>{const i=E(()=>n.uniqueId);var f=he(),b=$(f),t=o(b,2);x(()=>{w(b,"for",e(i)),w(t,"id",e(i)),t.disabled=e(u)}),D(t,()=>e(F),_=>s(F,_)),z(r,f)}}});var Y=o(K,2);let L;var N=o(l,4);let R;var S=o(N,2);U(S,r=>s(y,r),()=>e(y)),x((r,n)=>{L=W(Y,1,"btn btn-lg btn-block btn-next",null,L,r),R=W(N,1,"btn btn-lg btn-hint btn-transparent btn-block",null,R,n)},[()=>({"btn-disabled":e(u),"btn-loading":e(h)}),()=>({"btn-disabled":e(u),"btn-loading":e(g)})]),H("submit",l,ue(Q)),H("change",S,r=>{var n,i;V((i=(n=r.target)==null?void 0:n.files)==null?void 0:i[0])}),z(a,c)},$$slots:{default:!0}}),de()}export{ke as default};
