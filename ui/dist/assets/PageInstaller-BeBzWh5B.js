import{p as Z,a as ee,r as y,s,m as d,g as ae,b as f,c as te,t as se,d as e,l as re,e as ie,i as le,F as ne,f as $,h as q,j as i,k as oe,n as F,o as A,q as U,u as I,v as T,w as P,x as W,y as ue,z as de,A as ce,B as pe,C as fe,D as m,E as B,G as H}from"./index-Bek02XaP.js";var be=$('<label>Email</label> <input type="email" autocomplete="off" required=""/>',1),me=$('<label>Password</label> <input type="password" autocomplete="new-password" minlength="10" required=""/> <div class="help-block">Recommended at least 10 characters.</div>',1),he=$('<label>Password confirm</label> <input type="password" minlength="10" required=""/>',1),_e=$('<form class="block" autocomplete="off"><div class="content txt-center m-b-base"><h4>Create your first superuser account in order to continue</h4></div> <!> <!> <!> <button type="submit"><span class="txt">Create superuser and login</span> <i class="ri-arrow-right-line"></i></button></form> <hr/>  <label for="backupFileInput"><i class="ri-upload-cloud-line"></i> <span class="txt">Or initialize from backup</span></label> <input id="backupFileInput" type="file" class="hidden" accept=".zip"/>',1);function ke(J,D){Z(D,!1);const l=d();let b=ee(D,"params",8),k=d(""),w=d(""),x=d(""),c=d(!1),h=d(!1),z=d(),_=d();M();async function M(){if(!b()?.token)return y("/");s(c,!0);try{const a=ae(b()?.token);await f.collection("_superusers").getOne(a.id,{requestKey:"installer_token_check",headers:{Authorization:b()?.token}})}catch(a){a?.isAbort||(te("The installer token is invalid or has expired."),y("/"))}s(c,!1),await se(),e(z)?.focus()}async function Q(){if(!e(l)){s(c,!0);try{await f.collection("_superusers").create({email:e(k),password:e(w),passwordConfirm:e(x)},{headers:{Authorization:b()?.token}}),await f.collection("_superusers").authWithPassword(e(k),e(w)),y("/")}catch(a){f.error(a)}s(c,!1)}}function E(){e(_)&&fe(_,e(_).value="")}function V(a){a&&ce(`Note that we don't perform validations for the uploaded backup files. Proceed with caution and only if you trust the file source.

Do you really want to upload and initialize "${a.name}"?`,()=>{X(a)},()=>{E()})}async function X(a){if(!(!a||e(l))){s(h,!0);try{await f.backups.upload({file:a},{headers:{Authorization:b()?.token}}),await f.backups.restore(a.name,{headers:{Authorization:b()?.token}}),pe("Please wait while extracting the uploaded archive!"),await new Promise(g=>setTimeout(g,2e3)),y("/")}catch(g){f.error(g)}E(),s(h,!1)}}re(()=>(e(c),e(h)),()=>{s(l,e(c)||e(h))}),ie(),le(),ne(J,{children:(a,g)=>{var O=_e(),C=q(O),j=i(oe(C),2);F(j,{class:"form-field required",name:"email",children:A,$$slots:{default:(r,v)=>{const n=B(()=>v.uniqueId);var o=be(),u=q(o),t=i(u,2);U(t,p=>s(z,p),()=>e(z)),I(()=>{m(u,"for",e(n)),m(t,"id",e(n)),t.disabled=e(l)}),T(t,()=>e(k),p=>s(k,p)),P(r,o)}}});var G=i(j,2);F(G,{class:"form-field required",name:"password",children:A,$$slots:{default:(r,v)=>{const n=B(()=>v.uniqueId);var o=me(),u=q(o),t=i(u,2);I(()=>{m(u,"for",e(n)),m(t,"id",e(n)),t.disabled=e(l)}),T(t,()=>e(w),p=>s(w,p)),P(r,o)}}});var K=i(G,2);F(K,{class:"form-field required",name:"passwordConfirm",children:A,$$slots:{default:(r,v)=>{const n=B(()=>v.uniqueId);var o=he(),u=q(o),t=i(u,2);I(()=>{m(u,"for",e(n)),m(t,"id",e(n)),t.disabled=e(l)}),T(t,()=>e(x),p=>s(x,p)),P(r,o)}}});var Y=i(K,2);let L;var N=i(C,4);let R;var S=i(N,2);U(S,r=>s(_,r),()=>e(_)),I(()=>{L=H(Y,1,"btn btn-lg btn-block btn-next",null,L,{"btn-disabled":e(l),"btn-loading":e(c)}),R=H(N,1,"btn btn-lg btn-hint btn-transparent btn-block",null,R,{"btn-disabled":e(l),"btn-loading":e(h)})}),W("submit",C,ue(Q)),W("change",S,r=>{V(r.target?.files?.[0])}),P(a,O)},$$slots:{default:!0}}),de()}export{ke as default};
