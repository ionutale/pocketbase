import{p as ae,W as ie,a as k,m as v,T as le,s as C,d as i,l as x,M as m,e as se,i as ce,f as de,q as fe,w as ue,X as pe,A as ge,U as he,O as u,Y as ye,Z as ke}from"./index-D9eWXP5c.js";import{c as me,d as xe,s as be,h as we,a as Ee,E as K,b,e as Se,f as ve,g as Ce,i as Ke,j as Re,k as _e,l as Le,m as We,r as qe,n as Be,o as De,p as Oe,C as q,q as A,t as Te,S as Me,u as Ie,v as Ae}from"./index-Bo9OXKWE.js";function He(e){return new Worker(""+new URL("autocomplete.worker-BD3f6p4D.js",import.meta.url).href,{name:e?.name})}function Je(e){z(e,"start");var n={},t=e.languageData||{},g=!1;for(var p in e)if(p!=t&&e.hasOwnProperty(p))for(var h=n[p]=[],a=e[p],o=0;o<a.length;o++){var r=a[o];h.push(new Ne(r,e)),(r.indent||r.dedent)&&(g=!0)}return{name:t.name,startState:function(){return{state:"start",pending:null,indent:g?[]:null}},copyState:function(d){var y={state:d.state,pending:d.pending,indent:d.indent&&d.indent.slice(0)};return d.stack&&(y.stack=d.stack.slice(0)),y},token:Pe(n),indent:Ge(n,t),mergeTokens:t.mergeTokens,languageData:t}}function z(e,n){if(!e.hasOwnProperty(n))throw new Error("Undefined state "+n+" in simple mode")}function Ue(e,n){if(!e)return/(?:)/;var t="";return e instanceof RegExp?(e.ignoreCase&&(t="i"),e=e.source):e=String(e),new RegExp("^(?:"+e+")",t)}function Fe(e){if(!e)return null;if(e.apply)return e;if(typeof e=="string")return e.replace(/\./g," ");for(var n=[],t=0;t<e.length;t++)n.push(e[t]&&e[t].replace(/\./g," "));return n}function Ne(e,n){(e.next||e.push)&&z(n,e.next||e.push),this.regex=Ue(e.regex),this.token=Fe(e.token),this.data=e}function Pe(e){return function(n,t){if(t.pending){var g=t.pending.shift();return t.pending.length==0&&(t.pending=null),n.pos+=g.text.length,g.token}for(var p=e[t.state],h=0;h<p.length;h++){var a=p[h],o=(!a.data.sol||n.sol())&&n.match(a.regex);if(o){a.data.next?t.state=a.data.next:a.data.push?((t.stack||(t.stack=[])).push(t.state),t.state=a.data.push):a.data.pop&&t.stack&&t.stack.length&&(t.state=t.stack.pop()),a.data.indent&&t.indent.push(n.indentation()+n.indentUnit),a.data.dedent&&t.indent.pop();var r=a.token;if(r&&r.apply&&(r=r(o)),o.length>2&&a.token&&typeof a.token!="string"){t.pending=[];for(var d=2;d<o.length;d++)o[d]&&t.pending.push({text:o[d],token:a.token[d-1]});return n.backUp(o[0].length-(o[1]?o[1].length:0)),r[0]}else return r&&r.join?r[0]:r}}return n.next(),null}}function Ge(e,n){return function(t,g){if(t.indent==null||n.dontIndentStates&&n.dontIndentStates.indexOf(t.state)>-1)return null;var p=t.indent.length-1,h=e[t.state];e:for(;;){for(var a=0;a<h.length;a++){var o=h[a];if(o.data.dedent&&o.data.dedentIfLineStart!==!1){var r=o.regex.exec(g);if(r&&r[0]){p--,(o.next||o.push)&&(h=e[o.next||o.push]),g=g.slice(r[0].length);continue e}}}break}return p<0?0:t.indent[p]}}var Ve=de('<div class="code-editor"></div>');function Ze(e,n){ae(n,!1);const[t,g]=he(),p=()=>ye(ke,"$collections",t),h=ie();let a=k(n,"id",8,""),o=k(n,"value",12,""),r=k(n,"disabled",8,!1),d=k(n,"placeholder",8,""),y=k(n,"baseCollection",8,null),B=k(n,"singleLine",8,!1),Q=k(n,"extraAutocompleteKeys",24,()=>[]),R=k(n,"disableRequestKeys",8,!1),w=k(n,"disableCollectionJoinKeys",8,!1),f=v(),_=v(),D=v(r()),H=new q,J=new q,U=new q,F=new q,O=new He,N=[],P=[],G=[],L=v(""),T=v("");function W(){i(f)?.focus()}let M=null;O.onmessage=l=>{G=l.data.baseKeys||[],N=l.data.requestKeys||[],P=l.data.collectionJoinKeys||[]};function $(){clearTimeout(M),M=setTimeout(()=>{O.postMessage({baseCollection:y(),collections:te(p()),disableRequestKeys:R(),disableCollectionJoinKeys:w()})},250)}function ee(l){return JSON.stringify([l?.name,l?.type,l?.fields])}function te(l){let c=l.slice();return y()&&u.pushOrReplaceByKey(c,y(),"id"),c}function V(){i(_)?.dispatchEvent(new CustomEvent("change",{detail:{value:o()},bubbles:!0}))}function X(){if(!a())return;const l=document.querySelectorAll('[for="'+a()+'"]');for(let c of l)c.removeEventListener("click",W)}function Y(){if(!a())return;X();const l=document.querySelectorAll('[for="'+a()+'"]');for(let c of l)c.addEventListener("click",W)}function ne(l=!0,c=!0){let s=[].concat(Q());return s=s.concat(G||[]),l&&(s=s.concat(N||[])),c&&(s=s.concat(P||[])),s}function oe(l){let c=l.matchBefore(/[\'\"\@\w\.]*/);if(c&&c.from==c.to&&!l.explicit||Ae(l.state).resolveInner(l.pos,-1)?.type?.name=="comment")return null;let E=[{label:"false"},{label:"true"},{label:"@now"},{label:"@second"},{label:"@minute"},{label:"@hour"},{label:"@year"},{label:"@day"},{label:"@month"},{label:"@weekday"},{label:"@yesterday"},{label:"@tomorrow"},{label:"@todayStart"},{label:"@todayEnd"},{label:"@monthStart"},{label:"@monthEnd"},{label:"@yearStart"},{label:"@yearEnd"}];w()||E.push({label:"@collection.*",apply:"@collection."});let I=ne(!R()&&c.text.startsWith("@r"),!w()&&c.text.startsWith("@c"));for(const S of I)E.push({label:S.endsWith(".")?S+"*":S,apply:S,boost:S.indexOf("_via_")>0?-1:0});return{from:c.from,options:E}}function Z(){return Me.define(Je({start:[{regex:/true|false|null/,token:"atom"},{regex:/\/\/.*/,token:"comment"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\&\&|\|\||\=|\!\=|\~|\!\~|\>|\<|\>\=|\<\=/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/\w+[\w\.]*\w+/,token:"keyword"},{regex:u.escapeRegExp("@now"),token:"keyword"},{regex:u.escapeRegExp("@second"),token:"keyword"},{regex:u.escapeRegExp("@minute"),token:"keyword"},{regex:u.escapeRegExp("@hour"),token:"keyword"},{regex:u.escapeRegExp("@year"),token:"keyword"},{regex:u.escapeRegExp("@day"),token:"keyword"},{regex:u.escapeRegExp("@month"),token:"keyword"},{regex:u.escapeRegExp("@weekday"),token:"keyword"},{regex:u.escapeRegExp("@todayStart"),token:"keyword"},{regex:u.escapeRegExp("@todayEnd"),token:"keyword"},{regex:u.escapeRegExp("@monthStart"),token:"keyword"},{regex:u.escapeRegExp("@monthEnd"),token:"keyword"},{regex:u.escapeRegExp("@yearStart"),token:"keyword"},{regex:u.escapeRegExp("@yearEnd"),token:"keyword"},{regex:u.escapeRegExp("@request.method"),token:"keyword"}],meta:{lineComment:"//"}}))}le(()=>{const l={key:"Enter",run:s=>{B()&&h("submit",o())}};Y();let c=[l,...me,...xe,be.find(s=>s.key==="Mod-d"),...we,...Ee];return B()||c.push(Te),C(f,new K({parent:i(_),state:b.create({doc:o(),extensions:[Se(),ve(),Ce(),Ke(),Re(),b.allowMultipleSelections.of(!0),_e(Ie,{fallback:!0}),Le(),We(),qe(),Be(),De.of(c),K.lineWrapping,Oe({override:[oe],icons:!1}),F.of(A(d())),J.of(K.editable.of(!r())),U.of(b.readOnly.of(r())),H.of(Z()),b.transactionFilter.of(s=>{if(B()&&s.newDoc.lines>1){if(!s.changes?.inserted?.filter(E=>!!E.text.find(I=>I))?.length)return[];s.newDoc.text=[s.newDoc.text.join(" ")]}return s}),K.updateListener.of(s=>{!s.docChanged||r()||(o(s.state.doc.toString()),V())})]})})),()=>{clearTimeout(M),X(),i(f)?.destroy(),O.terminate()}}),x(()=>m(y()),()=>{C(L,ee(y()))}),x(()=>(m(r()),i(T),i(L),m(R()),m(w())),()=>{!r()&&(i(T)!=i(L)||R()!==-1||w()!==-1)&&(C(T,i(L)),$())}),x(()=>m(a()),()=>{a()&&Y()}),x(()=>(i(f),m(y())),()=>{i(f)&&y()?.fields&&i(f).dispatch({effects:[H.reconfigure(Z())]})}),x(()=>(i(f),i(D),m(r()),b),()=>{i(f)&&i(D)!=r()&&(i(f).dispatch({effects:[J.reconfigure(K.editable.of(!r())),U.reconfigure(b.readOnly.of(r()))]}),C(D,r()),V())}),x(()=>(i(f),m(o())),()=>{i(f)&&o()!=i(f).state.doc.toString()&&i(f).dispatch({changes:{from:0,to:i(f).state.doc.length,insert:o()}})}),x(()=>(i(f),m(d()),A),()=>{i(f)&&typeof d()<"u"&&i(f).dispatch({effects:[F.reconfigure(A(d()))]})}),se(),ce();var j=Ve();fe(j,l=>C(_,l),()=>i(_)),ue(e,j),pe(n,"focus",W);var re=ge({focus:W});return g(),re}export{Ze as default};
