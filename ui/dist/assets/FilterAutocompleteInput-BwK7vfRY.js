import{p as se,W as le,a as k,m as v,T as de,s as K,d as l,l as b,M as m,e as ce,i as fe,f as ue,q as ge,w as pe,X as he,A as ye,U as ke,O as u,Y as me,Z as xe}from"./index-QTvxZBYq.js";import{c as be,d as we,s as Ee,h as Se,a as Ce,E as R,b as E,e as ve,f as Ke,g as Re,i as _e,j as Le,k as We,l as qe,m as Oe,r as Te,n as De,o as Me,p as Be,C as T,q as H,t as Ie,S as Ae,u as He,v as Je}from"./index-C7rLKPou.js";function Ue(e){return new Worker(""+new URL("autocomplete.worker-Brxis5lC.js",import.meta.url).href,{name:e==null?void 0:e.name})}function Fe(e){Q(e,"start");var a={},t=e.languageData||{},p=!1;for(var g in e)if(g!=t&&e.hasOwnProperty(g))for(var h=a[g]=[],i=e[g],r=0;r<i.length;r++){var o=i[r];h.push(new Ge(o,e)),(o.indent||o.dedent)&&(p=!0)}return{name:t.name,startState:function(){return{state:"start",pending:null,indent:p?[]:null}},copyState:function(c){var y={state:c.state,pending:c.pending,indent:c.indent&&c.indent.slice(0)};return c.stack&&(y.stack=c.stack.slice(0)),y},token:Ve(a),indent:Xe(a,t),mergeTokens:t.mergeTokens,languageData:t}}function Q(e,a){if(!e.hasOwnProperty(a))throw new Error("Undefined state "+a+" in simple mode")}function Ne(e,a){if(!e)return/(?:)/;var t="";return e instanceof RegExp?(e.ignoreCase&&(t="i"),e=e.source):e=String(e),new RegExp("^(?:"+e+")",t)}function Pe(e){if(!e)return null;if(e.apply)return e;if(typeof e=="string")return e.replace(/\./g," ");for(var a=[],t=0;t<e.length;t++)a.push(e[t]&&e[t].replace(/\./g," "));return a}function Ge(e,a){(e.next||e.push)&&Q(a,e.next||e.push),this.regex=Ne(e.regex),this.token=Pe(e.token),this.data=e}function Ve(e){return function(a,t){if(t.pending){var p=t.pending.shift();return t.pending.length==0&&(t.pending=null),a.pos+=p.text.length,p.token}for(var g=e[t.state],h=0;h<g.length;h++){var i=g[h],r=(!i.data.sol||a.sol())&&a.match(i.regex);if(r){i.data.next?t.state=i.data.next:i.data.push?((t.stack||(t.stack=[])).push(t.state),t.state=i.data.push):i.data.pop&&t.stack&&t.stack.length&&(t.state=t.stack.pop()),i.data.indent&&t.indent.push(a.indentation()+a.indentUnit),i.data.dedent&&t.indent.pop();var o=i.token;if(o&&o.apply&&(o=o(r)),r.length>2&&i.token&&typeof i.token!="string"){t.pending=[];for(var c=2;c<r.length;c++)r[c]&&t.pending.push({text:r[c],token:i.token[c-1]});return a.backUp(r[0].length-(r[1]?r[1].length:0)),o[0]}else return o&&o.join?o[0]:o}}return a.next(),null}}function Xe(e,a){return function(t,p){if(t.indent==null||a.dontIndentStates&&a.dontIndentStates.indexOf(t.state)>-1)return null;var g=t.indent.length-1,h=e[t.state];e:for(;;){for(var i=0;i<h.length;i++){var r=h[i];if(r.data.dedent&&r.data.dedentIfLineStart!==!1){var o=r.regex.exec(p);if(o&&o[0]){g--,(r.next||r.push)&&(h=e[r.next||r.push]),p=p.slice(o[0].length);continue e}}}break}return g<0?0:t.indent[g]}}var Ye=ue('<div class="code-editor"></div>');function ze(e,a){se(a,!1);const[t,p]=ke(),g=()=>me(xe,"$collections",t),h=le();let i=k(a,"id",8,""),r=k(a,"value",12,""),o=k(a,"disabled",8,!1),c=k(a,"placeholder",8,""),y=k(a,"baseCollection",8,null),D=k(a,"singleLine",8,!1),$=k(a,"extraAutocompleteKeys",24,()=>[]),_=k(a,"disableRequestKeys",8,!1),S=k(a,"disableCollectionJoinKeys",8,!1),f=v(),L=v(),M=v(o()),J=new T,U=new T,F=new T,N=new T,B=new Ue,P=[],G=[],V=[],W=v(""),I=v("");function q(){var n;(n=l(f))==null||n.focus()}let A=null;B.onmessage=n=>{V=n.data.baseKeys||[],P=n.data.requestKeys||[],G=n.data.collectionJoinKeys||[]};function ee(){clearTimeout(A),A=setTimeout(()=>{B.postMessage({baseCollection:y(),collections:ne(g()),disableRequestKeys:_(),disableCollectionJoinKeys:S()})},250)}function te(n){return JSON.stringify([n==null?void 0:n.name,n==null?void 0:n.type,n==null?void 0:n.fields])}function ne(n){let d=n.slice();return y()&&u.pushOrReplaceByKey(d,y(),"id"),d}function X(){var n;(n=l(L))==null||n.dispatchEvent(new CustomEvent("change",{detail:{value:r()},bubbles:!0}))}function Y(){if(!i())return;const n=document.querySelectorAll('[for="'+i()+'"]');for(let d of n)d.removeEventListener("click",q)}function Z(){if(!i())return;Y();const n=document.querySelectorAll('[for="'+i()+'"]');for(let d of n)d.addEventListener("click",q)}function ae(n=!0,d=!0){let s=[].concat($());return s=s.concat(V||[]),n&&(s=s.concat(P||[])),d&&(s=s.concat(G||[])),s}function re(n){var C;let d=n.matchBefore(/[\'\"\@\w\.]*/);if(d&&d.from==d.to&&!n.explicit)return null;let s=Je(n.state).resolveInner(n.pos,-1);if(((C=s==null?void 0:s.type)==null?void 0:C.name)=="comment")return null;let w=[{label:"false"},{label:"true"},{label:"@now"},{label:"@second"},{label:"@minute"},{label:"@hour"},{label:"@year"},{label:"@day"},{label:"@month"},{label:"@weekday"},{label:"@yesterday"},{label:"@tomorrow"},{label:"@todayStart"},{label:"@todayEnd"},{label:"@monthStart"},{label:"@monthEnd"},{label:"@yearStart"},{label:"@yearEnd"}];S()||w.push({label:"@collection.*",apply:"@collection."});let O=ae(!_()&&d.text.startsWith("@r"),!S()&&d.text.startsWith("@c"));for(const x of O)w.push({label:x.endsWith(".")?x+"*":x,apply:x,boost:x.indexOf("_via_")>0?-1:0});return{from:d.from,options:w}}function j(){return Ae.define(Fe({start:[{regex:/true|false|null/,token:"atom"},{regex:/\/\/.*/,token:"comment"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\&\&|\|\||\=|\!\=|\~|\!\~|\>|\<|\>\=|\<\=/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/\w+[\w\.]*\w+/,token:"keyword"},{regex:u.escapeRegExp("@now"),token:"keyword"},{regex:u.escapeRegExp("@second"),token:"keyword"},{regex:u.escapeRegExp("@minute"),token:"keyword"},{regex:u.escapeRegExp("@hour"),token:"keyword"},{regex:u.escapeRegExp("@year"),token:"keyword"},{regex:u.escapeRegExp("@day"),token:"keyword"},{regex:u.escapeRegExp("@month"),token:"keyword"},{regex:u.escapeRegExp("@weekday"),token:"keyword"},{regex:u.escapeRegExp("@todayStart"),token:"keyword"},{regex:u.escapeRegExp("@todayEnd"),token:"keyword"},{regex:u.escapeRegExp("@monthStart"),token:"keyword"},{regex:u.escapeRegExp("@monthEnd"),token:"keyword"},{regex:u.escapeRegExp("@yearStart"),token:"keyword"},{regex:u.escapeRegExp("@yearEnd"),token:"keyword"},{regex:u.escapeRegExp("@request.method"),token:"keyword"}],meta:{lineComment:"//"}}))}de(()=>{const n={key:"Enter",run:s=>{D()&&h("submit",r())}};Z();let d=[n,...be,...we,Ee.find(s=>s.key==="Mod-d"),...Se,...Ce];return D()||d.push(Ie),K(f,new R({parent:l(L),state:E.create({doc:r(),extensions:[ve(),Ke(),Re(),_e(),Le(),E.allowMultipleSelections.of(!0),We(He,{fallback:!0}),qe(),Oe(),Te(),De(),Me.of(d),R.lineWrapping,Be({override:[re],icons:!1}),N.of(H(c())),U.of(R.editable.of(!o())),F.of(E.readOnly.of(o())),J.of(j()),E.transactionFilter.of(s=>{var w,O,C;if(D()&&s.newDoc.lines>1){if(!((C=(O=(w=s.changes)==null?void 0:w.inserted)==null?void 0:O.filter(x=>!!x.text.find(ie=>ie)))!=null&&C.length))return[];s.newDoc.text=[s.newDoc.text.join(" ")]}return s}),R.updateListener.of(s=>{!s.docChanged||o()||(r(s.state.doc.toString()),X())})]})})),()=>{var s;clearTimeout(A),Y(),(s=l(f))==null||s.destroy(),B.terminate()}}),b(()=>m(y()),()=>{K(W,te(y()))}),b(()=>(m(o()),l(I),l(W),m(_()),m(S())),()=>{!o()&&(l(I)!=l(W)||_()!==-1||S()!==-1)&&(K(I,l(W)),ee())}),b(()=>m(i()),()=>{i()&&Z()}),b(()=>(l(f),m(y())),()=>{var n;l(f)&&((n=y())!=null&&n.fields)&&l(f).dispatch({effects:[J.reconfigure(j())]})}),b(()=>(l(f),l(M),m(o()),E),()=>{l(f)&&l(M)!=o()&&(l(f).dispatch({effects:[U.reconfigure(R.editable.of(!o())),F.reconfigure(E.readOnly.of(o()))]}),K(M,o()),X())}),b(()=>(l(f),m(r())),()=>{l(f)&&r()!=l(f).state.doc.toString()&&l(f).dispatch({changes:{from:0,to:l(f).state.doc.length,insert:r()}})}),b(()=>(l(f),m(c()),H),()=>{l(f)&&typeof c()<"u"&&l(f).dispatch({effects:[N.reconfigure(H(c()))]})}),ce(),fe();var z=Ye();ge(z,n=>K(L,n),()=>l(L)),pe(e,z),he(a,"focus",q);var oe=ye({focus:q});return p(),oe}export{ze as default};
