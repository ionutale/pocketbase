import{p as ie,W as le,a as k,m as v,T as se,s as C,d as i,l as x,M as m,e as ce,i as de,f as fe,q as ue,w as pe,X as ge,z as he,U as ye,O as u,Y as ke,Z as me}from"./index-BMgSTU82.js";import{c as xe,d as be,s as we,h as Ee,a as Se,E as K,b,e as ve,f as Ce,g as Ke,i as Re,j as _e,k as Le,l as Oe,m as We,r as qe,n as Be,o as De,p as Te,C as W,q as H,t as Ie,S as Me,u as He,v as Je}from"./index-BYqHMM3t.js";function Ae(e){return new Worker(""+new URL("autocomplete.worker-DnOintHI.js",import.meta.url).href,{name:e?.name})}function Ue(e){j(e,"start");var n={},t=e.languageData||{},g=!1;for(var p in e)if(p!=t&&e.hasOwnProperty(p))for(var h=n[p]=[],a=e[p],o=0;o<a.length;o++){var r=a[o];h.push(new Pe(r,e)),(r.indent||r.dedent)&&(g=!0)}return{name:t.name,startState:function(){return{state:"start",pending:null,indent:g?[]:null}},copyState:function(d){var y={state:d.state,pending:d.pending,indent:d.indent&&d.indent.slice(0)};return d.stack&&(y.stack=d.stack.slice(0)),y},token:ze(n),indent:Ge(n,t),mergeTokens:t.mergeTokens,languageData:t}}function j(e,n){if(!e.hasOwnProperty(n))throw new Error("Undefined state "+n+" in simple mode")}function Fe(e,n){if(!e)return/(?:)/;var t="";return e instanceof RegExp?(e.ignoreCase&&(t="i"),e.unicode&&(t+="u"),e=e.source):e=String(e),new RegExp("^(?:"+e+")",t)}function Ne(e){if(!e)return null;if(e.apply)return e;if(typeof e=="string")return e.replace(/\./g," ");for(var n=[],t=0;t<e.length;t++)n.push(e[t]&&e[t].replace(/\./g," "));return n}function Pe(e,n){(e.next||e.push)&&j(n,e.next||e.push),this.regex=Fe(e.regex),this.token=Ne(e.token),this.data=e}function ze(e){return function(n,t){if(t.pending){var g=t.pending.shift();return t.pending.length==0&&(t.pending=null),n.pos+=g.text.length,g.token}for(var p=e[t.state],h=0;h<p.length;h++){var a=p[h],o=(!a.data.sol||n.sol())&&n.match(a.regex);if(o){a.data.next?t.state=a.data.next:a.data.push?((t.stack||(t.stack=[])).push(t.state),t.state=a.data.push):a.data.pop&&t.stack&&t.stack.length&&(t.state=t.stack.pop()),a.data.indent&&t.indent.push(n.indentation()+n.indentUnit),a.data.dedent&&t.indent.pop();var r=a.token;if(r&&r.apply&&(r=r(o)),o.length>2&&a.token&&typeof a.token!="string"){t.pending=[];for(var d=2;d<o.length;d++)o[d]&&t.pending.push({text:o[d],token:a.token[d-1]});return n.backUp(o[0].length-(o[1]?o[1].length:0)),r[0]}else return r&&r.join?r[0]:r}}return n.next(),null}}function Ge(e,n){return function(t,g){if(t.indent==null||n.dontIndentStates&&n.dontIndentStates.indexOf(t.state)>-1)return null;var p=t.indent.length-1,h=e[t.state];e:for(;;){for(var a=0;a<h.length;a++){var o=h[a];if(o.data.dedent&&o.data.dedentIfLineStart!==!1){var r=o.regex.exec(g);if(r&&r[0]){p--,(o.next||o.push)&&(h=e[o.next||o.push]),g=g.slice(r[0].length);continue e}}}break}return p<0?0:t.indent[p]}}var Ve=fe('<div class="code-editor"></div>');function Ze(e,n){ie(n,!1);const t=()=>ke(me,"$collections",g),[g,p]=ye(),h=le();let a=k(n,"id",8,""),o=k(n,"value",12,""),r=k(n,"disabled",8,!1),d=k(n,"placeholder",8,""),y=k(n,"baseCollection",8,null),q=k(n,"singleLine",8,!1),Q=k(n,"extraAutocompleteKeys",24,()=>[]),R=k(n,"disableRequestKeys",8,!1),w=k(n,"disableCollectionJoinKeys",8,!1),f=v(),_=v(),B=v(r()),J=new W,A=new W,U=new W,F=new W,D=new Ae,N=[],P=[],z=[],L=v(""),T=v("");function O(){i(f)?.focus()}let I=null;D.onmessage=l=>{z=l.data.baseKeys||[],N=l.data.requestKeys||[],P=l.data.collectionJoinKeys||[]};function $(){clearTimeout(I),I=setTimeout(()=>{D.postMessage({baseCollection:y(),collections:te(t()),disableRequestKeys:R(),disableCollectionJoinKeys:w()})},250)}function ee(l){return JSON.stringify([l?.name,l?.type,l?.fields])}function te(l){let c=l.slice();return y()&&u.pushOrReplaceByKey(c,y(),"id"),c}function G(){i(_)?.dispatchEvent(new CustomEvent("change",{detail:{value:o()},bubbles:!0}))}function V(){if(!a())return;const l=document.querySelectorAll('[for="'+a()+'"]');for(let c of l)c.removeEventListener("click",O)}function X(){if(!a())return;V();const l=document.querySelectorAll('[for="'+a()+'"]');for(let c of l)c.addEventListener("click",O)}function ne(l=!0,c=!0){let s=[].concat(Q());return s=s.concat(z||[]),l&&(s=s.concat(N||[])),c&&(s=s.concat(P||[])),s}function oe(l){let c=l.matchBefore(/[\'\"\@\w\.\:]*/);if(c&&c.from==c.to&&!l.explicit||Je(l.state).resolveInner(l.pos,-1)?.type?.name=="comment")return null;let E=[{label:"false"},{label:"true"},{label:"@now"},{label:"@second"},{label:"@minute"},{label:"@hour"},{label:"@year"},{label:"@day"},{label:"@month"},{label:"@weekday"},{label:"@yesterday"},{label:"@tomorrow"},{label:"@todayStart"},{label:"@todayEnd"},{label:"@monthStart"},{label:"@monthEnd"},{label:"@yearStart"},{label:"@yearEnd"}];w()||E.push({label:"@collection.*",apply:"@collection."});let M=ne(!R()&&c.text.startsWith("@r"),!w()&&c.text.startsWith("@c"));for(const S of M)E.push({label:S.endsWith(".")?S+"*":S,apply:S,boost:S.indexOf("_via_")>0?-1:0});return{from:c.from,options:E}}function Y(){return Me.define(Ue({start:[{regex:/true|false|null/,token:"atom"},{regex:/\/\/.*/,token:"comment"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\&\&|\|\||\=|\!\=|\~|\!\~|\>|\<|\>\=|\<\=/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/\w+[\w\.]*\w+/,token:"keyword"},{regex:u.escapeRegExp("@now"),token:"keyword"},{regex:u.escapeRegExp("@second"),token:"keyword"},{regex:u.escapeRegExp("@minute"),token:"keyword"},{regex:u.escapeRegExp("@hour"),token:"keyword"},{regex:u.escapeRegExp("@year"),token:"keyword"},{regex:u.escapeRegExp("@day"),token:"keyword"},{regex:u.escapeRegExp("@month"),token:"keyword"},{regex:u.escapeRegExp("@weekday"),token:"keyword"},{regex:u.escapeRegExp("@todayStart"),token:"keyword"},{regex:u.escapeRegExp("@todayEnd"),token:"keyword"},{regex:u.escapeRegExp("@monthStart"),token:"keyword"},{regex:u.escapeRegExp("@monthEnd"),token:"keyword"},{regex:u.escapeRegExp("@yearStart"),token:"keyword"},{regex:u.escapeRegExp("@yearEnd"),token:"keyword"},{regex:u.escapeRegExp("@request.method"),token:"keyword"}],meta:{lineComment:"//"}}))}se(()=>{const l={key:"Enter",run:s=>{q()&&h("submit",o())}};X();let c=[l,...xe,...be,we.find(s=>s.key==="Mod-d"),...Ee,...Se];return q()||c.push(Ie),C(f,new K({parent:i(_),state:b.create({doc:o(),extensions:[ve(),Ce(),Ke(),Re(),_e(),b.allowMultipleSelections.of(!0),Le(He,{fallback:!0}),Oe(),We(),qe(),Be(),De.of(c),K.lineWrapping,Te({override:[oe],icons:!1}),F.of(H(d())),A.of(K.editable.of(!r())),U.of(b.readOnly.of(r())),J.of(Y()),b.transactionFilter.of(s=>{if(q()&&s.newDoc.lines>1){if(!s.changes?.inserted?.filter(E=>!!E.text.find(M=>M))?.length)return[];s.newDoc.text=[s.newDoc.text.join(" ")]}return s}),K.updateListener.of(s=>{!s.docChanged||r()||(o(s.state.doc.toString()),G())})]})})),()=>{clearTimeout(I),V(),i(f)?.destroy(),D.terminate()}}),x(()=>m(y()),()=>{C(L,ee(y()))}),x(()=>(m(r()),i(T),i(L),m(R()),m(w())),()=>{!r()&&(i(T)!=i(L)||R()!==-1||w()!==-1)&&(C(T,i(L)),$())}),x(()=>m(a()),()=>{a()&&X()}),x(()=>(i(f),m(y())),()=>{i(f)&&y()?.fields&&i(f).dispatch({effects:[J.reconfigure(Y())]})}),x(()=>(i(f),i(B),m(r()),b),()=>{i(f)&&i(B)!=r()&&(i(f).dispatch({effects:[A.reconfigure(K.editable.of(!r())),U.reconfigure(b.readOnly.of(r()))]}),C(B,r()),G())}),x(()=>(i(f),m(o())),()=>{i(f)&&o()!=i(f).state.doc.toString()&&i(f).dispatch({changes:{from:0,to:i(f).state.doc.length,insert:o()}})}),x(()=>(i(f),m(d()),H),()=>{i(f)&&typeof d()<"u"&&i(f).dispatch({effects:[F.reconfigure(H(d()))]})}),ce();var re={focus:O};de();var Z=Ve();ue(Z,l=>C(_,l),()=>i(_)),pe(e,Z),ge(n,"focus",O);var ae=he(re);return p(),ae}export{Ze as default};
